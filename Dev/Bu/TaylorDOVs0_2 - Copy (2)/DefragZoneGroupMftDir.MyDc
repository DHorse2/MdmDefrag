SetVariable(FileStepDescription,"Calculating Gap for MFT and DIR.")
!include "..\Display\BannerDescriptionSet.MyDc"!

AppendLogfile("!LogFileName!", "MftLocation: !MftLocation! DoNotVacate !Date! !Time!")

SetVariable(MftGapSlack, MftLocation - VolumeUsedTotal)
AppendLogfile("!LogFileName!", "MftGapSlack: !MftGapSlack!")

SetVariable(MftGapSlackPerUsed, MftGapSlack / VolumeFreeAdj)
AppendLogfile("!LogFileName!", "MftGapSlackPerUsed: !MftGapSlackPerUsed!")

AppendLogfile("!LogFileName!", "VolumeUsed before: !VolumeUsedTotal!")
SetVariable(VolumeUsedTotal, MftLocation)
AppendLogfile("!LogFileName!", "VolumeUsed at location: !VolumeUsedTotal!")

SetVariable(VolumeFreePerUsed, VolumeFreePerUsed + (MftGapSlack / VolumeFree))
AppendLogfile("!LogFileName!", "VolumeFreePerUsed: !VolumeFreePerUsed!")

/* ---------------------------------------------------------- */
#  MFT
/* Mft Method: MakeGap(MftLocation, DoNotVacate) */ 

!include "..\ZoneTypeDefrag\DefragZoneTypeOsMft.MyDc"!
  
/* ---------------------------------------------------------- */
# DIR

!include "..\ZoneTypeDefrag\DefragZoneTypeOsDir.MyDc"!

/* ---------------------------------------------------------- */
/* Mft Method: MFT GAP HERE. */
/* For fixed zone locations */
AppendLogfile("!LogFileName!", "Mft Zone: !MftZone! Location: !MftLocation! Gap: !MftGap! !Date! !Time!")
/* MakeGap(MftGap, DoNotVacate) */
  
/* ---------------------------------------------------------- */
# PageHiberDump

# You cannot move Pagefile or Hiberfil generally speaking.
# This might work in safe mode with preparation.
# Zone PageHiberDump.
# Possibly a Gap should be vacated so there is a space available upon recreation of the files.

!include "..\ZoneTypeDefrag\DefragZoneTypeOsPageHiberDump.MyDc"!

/* ---------------------------------------------------------- */
