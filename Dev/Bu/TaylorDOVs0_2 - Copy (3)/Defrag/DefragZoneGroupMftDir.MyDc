SetVariable(FileStepDescription,"Calculating Gap for MFT and DIR.")
!include "..\..\Display\BannerDescriptionSet.MyDc"!

SetVariable(MftReport,"")

SetVariable(MftReport, "!MftReport!MftLocation: !MftLocation! !Date! !Time!")
# SetVariable(MftSize, !MftSize!)
SetVariable(MftReport, "!MftReport!MftSize: !MftSize!")

SetVariable(MftGapSlack, MftLocation - VolumeUsedTotal)
SetVariable(MftReport, "!MftReport!MftGapSlack: !MftGapSlack!")

SetVariable(MftGapSlackPerUsed, MftGapSlack / VolumeFreeAdj)
SetVariable(MftReport, "!MftReport!MftGapSlackPerUsed: !MftGapSlackPerUsed!")

SetVariable(MftReport, "!MftReport!VolumeUsed before: !VolumeUsedTotal!")
SetVariable(VolumeUsedTotal, MftLocation)
SetVariable(MftReport, "!MftReport!VolumeUsed at location: !VolumeUsedTotal!")

SetVariable(VolumeFreePerUsed, VolumeFreePerUsed + (MftGapSlack / VolumeFree))
SetVariable(MftReport, "!MftReport!VolumeFreePerUsed: !VolumeFreePerUsed!")

/* ---------------------------------------------------------- */
#  MFT
/* Mft Method: MakeGap(MftLocation, DoNotVacate) */ 

!include "..\..\Zone\ZoneTypeDefrag\DefragZoneTypeOsMft.MyDc"!
  
/* ---------------------------------------------------------- */
# DIR

!include "..\..\Zone\ZoneTypeDefrag\DefragZoneTypeOsDir.MyDc"!

/* ---------------------------------------------------------- */
/* Mft Method: MFT GAP HERE. */
/* For fixed zone locations */
WriteLogfile("!LogFileName! Volume !VolumenName! MftReport", "!MftReport!Mft Zone: !MftZone! Location: !MftLocation! Gap: !MftGap! !Date! !Time!")
/* MakeGap(MftGap, DoNotVacate) */
  
/* ---------------------------------------------------------- */
# PageHiberDump

# You cannot move Pagefile or Hiberfil generally speaking.
# This might work in safe mode with preparation.
# Zone PageHiberDump.
# Possibly a Gap should be vacated so there is a space available upon recreation of the files.

!include "..\..\Zone\ZoneTypeDefrag\DefragZoneTypeOsPageHiberDump.MyDc"!
AppendLogfile("!LogFileName!","!MftReport!")

/* ---------------------------------------------------------- */
